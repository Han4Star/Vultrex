<!DOCTYPE html>
<html lang="de" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vultrex Pro | Enterprise System V9</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class', // Wichtig für den Light/Dark Switch
            theme: {
                extend: {
                    colors: {
                        // Spezielle Blautöne für das Branding
                        brand: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            900: '#1e3a8a',
                        },
                        // Dunkle Hintergründe
                        darkbg: {
                            900: '#0f172a',
                            800: '#1e293b'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    }
                }
            }
        }
    </script>

    <style>
        /* =========================================
           SCHRIFTARTEN & IMPORTS
           =========================================
        */
        @import url('https://fonts.cdnfonts.com/css/minecraft-4');
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&family=JetBrains+Mono:wght@500&display=swap');

        /* =========================================
           BASIS STYLING
           =========================================
        */
        body {
            /* Sanfter Übergang beim Umschalten des Themes */
            transition: background-color 0.3s ease, color 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        /* =========================================
           CUSTOM SCROLLBAR
           Damit es auch beim Scrollen gut aussieht
           =========================================
        */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #334155;
        }

        /* =========================================
           SPEZIELLE KOMPONENTEN
           =========================================
        */

        /* Minecraft Schriftart für den Server Status */
        .mc-font {
            font-family: 'Minecraft', sans-serif !important;
            text-shadow: 1px 1px 0px rgba(0,0,0,0.5);
            letter-spacing: 0.5px;
        }

        /* Die Haupt-Karte (Box) */
        .v-card {
            background-color: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 1.25rem; /* Abgerundete Ecken */
            padding: 1.5rem;        /* Innenabstand */
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease-in-out;
        }

        /* Dark Mode für die Karte */
        .dark .v-card {
            background-color: #0f172a;
            border-color: #1e293b;
            box-shadow: none;
        }

        /* Hover Effekt für Interaktivität */
        .v-card-hover:hover {
            transform: translateY(-2px);
            border-color: #3b82f6;
        }

        /* =========================================
           DER TOGGLE SWITCH (AN/AUS SCHALTER)
           =========================================
        */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Wenn aktiviert (checked) */
        input:checked + .slider {
            background-color: #3b82f6;
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        /* Dark Mode Slider Hintergrund */
        .dark .slider {
            background-color: #334155;
        }

        /* =========================================
           HELPER KLASSEN
           =========================================
        */
        .page-hidden {
            display: none !important;
        }

        .sidebar-transition {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>

<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 min-h-screen font-sans selection:bg-blue-500 selection:text-white">

    <div id="sidebar" class="sidebar-transition fixed inset-y-0 left-0 w-[280px] bg-white dark:bg-slate-900 z-[60] border-r border-slate-200 dark:border-slate-800 shadow-2xl -translate-x-full">
        <div class="flex flex-col h-full p-6">
            
            <div class="mb-12 pl-4 border-l-4 border-blue-600">
                <h1 class="text-2xl font-black italic tracking-tighter uppercase text-slate-900 dark:text-white">
                    Vultrex
                </h1>
                <span class="text-[10px] font-bold text-blue-500 uppercase tracking-[0.3em]">
                    Enterprise
                </span>
            </div>

            <nav class="space-y-2 flex-1">
                <button onclick="ui.switchPage('dashboard')" class="w-full text-left px-4 py-4 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 font-bold transition-all text-sm flex items-center gap-3 group">
                    <span class="w-1 h-4 bg-slate-300 dark:bg-slate-600 rounded group-hover:bg-blue-500 transition-colors"></span>
                    <span data-i18n="nav_dash">Dashboard</span>
                </button>

                <button onclick="ui.switchPage('monitor')" class="w-full text-left px-4 py-4 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 font-bold transition-all text-sm flex items-center gap-3 group">
                    <span class="w-1 h-4 bg-slate-300 dark:bg-slate-600 rounded group-hover:bg-blue-500 transition-colors"></span>
                    <span data-i18n="nav_monitor">Server Monitor</span>
                </button>

                <button onclick="ui.openAdminPin()" class="w-full text-left px-4 py-4 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 font-bold transition-all text-sm flex items-center gap-3 group">
                    <span class="w-1 h-4 bg-slate-300 dark:bg-slate-600 rounded group-hover:bg-blue-500 transition-colors"></span>
                    <span data-i18n="nav_admin">Admin Panel</span>
                </button>
            </nav>

            <div class="pt-8 mt-6 border-t border-slate-100 dark:border-slate-800">
                <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4 px-2">System</p>
                
                <div class="flex items-center justify-between mb-6 px-2">
                    <span class="text-xs font-bold text-slate-600 dark:text-slate-300" data-i18n="theme_label">Dark Mode</span>
                    <label class="switch">
                        <input type="checkbox" id="theme-toggle" onchange="ui.toggleTheme()">
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="px-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase mb-2 block">Language</label>
                    <select onchange="ui.setLanguage(this.value)" id="lang-select" class="w-full bg-slate-100 dark:bg-slate-800 p-3 rounded-lg text-xs font-bold border-none outline-none cursor-pointer hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors">
                        <option value="de">Deutsch</option>
                        <option value="en">English</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <div id="overlay" onclick="ui.toggleSidebar()" class="fixed inset-0 bg-black/60 z-[55] hidden backdrop-blur-sm transition-opacity duration-300 opacity-0"></div>

    <div class="max-w-5xl mx-auto p-4 md:p-8 min-h-screen flex flex-col">
        
        <header class="flex justify-between items-center mb-10 mt-2">
            <button onclick="ui.toggleSidebar()" class="w-12 h-12 flex items-center justify-center bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm hover:bg-slate-50 dark:hover:bg-slate-800 transition-all active:scale-95">
                <div class="flex flex-col gap-[5px]">
                    <div class="w-5 h-0.5 bg-slate-800 dark:bg-white rounded-full"></div>
                    <div class="w-5 h-0.5 bg-slate-800 dark:bg-white rounded-full"></div>
                    <div class="w-5 h-0.5 bg-slate-800 dark:bg-white rounded-full"></div>
                </div>
            </button>
            
            <div class="flex items-center gap-3">
                <span class="text-2xl font-black italic text-blue-600 tracking-tighter uppercase">VULTREX</span>
                <div class="h-6 w-px bg-slate-300 dark:bg-slate-700 mx-2"></div>
                <span class="text-xs font-bold text-slate-400 uppercase tracking-[0.2em]">Pro V9</span>
            </div>
            
            <div class="w-12"></div>
        </header>

        <div id="page-dashboard" class="space-y-6 flex-1 fade-in">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="v-card flex justify-between items-center group">
                    <div>
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em] mb-2" data-i18n="card_balance">Aktuelle Bilanz</p>
                        <p id="balance-display" class="text-3xl font-black text-slate-900 dark:text-white tracking-tight">0.00 €</p>
                    </div>
                    <div class="w-12 h-12 rounded-full bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-blue-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </div>
                </div>

                <div class="v-card flex justify-between items-center group">
                    <div>
                        <p class="text-[10px] font-bold text-rose-500 uppercase tracking-[0.2em] mb-2" data-i18n="card_costs">Fixkosten</p>
                        <p id="costs-display" class="text-3xl font-black text-rose-500 tracking-tight">0.00 €</p>
                    </div>
                    <div class="w-12 h-12 rounded-full bg-rose-50 dark:bg-rose-900/20 flex items-center justify-center text-rose-500">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                    </div>
                </div>
            </div>

            <div class="v-card">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xs font-black uppercase text-slate-400 tracking-widest">Analytics</h3>
                </div>
                <div class="h-[300px] w-full relative">
                    <canvas id="financeChart"></canvas>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <button onclick="ui.openModal('manual')" class="bg-blue-600 text-white py-4 rounded-xl font-black uppercase text-xs tracking-[0.2em] shadow-lg shadow-blue-500/25 hover:bg-blue-500 active:scale-[0.98] transition-all" data-i18n="btn_entry">
                    Eintrag
                </button>
                <button onclick="ui.openModal('import')" class="bg-slate-800 dark:bg-white dark:text-slate-900 text-white py-4 rounded-xl font-black uppercase text-xs tracking-[0.2em] shadow-lg hover:opacity-90 active:scale-[0.98] transition-all flex items-center justify-center gap-2" data-i18n="btn_scan">
                    <span>⚡</span> Smart Scan
                </button>
            </div>

            <div class="mt-8">
                <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4 ml-1">Verlauf</h3>
                <div id="transaction-list" class="space-y-3 pb-20">
                    </div>
            </div>
        </div>

        <div id="page-monitor" class="page-hidden space-y-6 fade-in">
            <div class="v-card">
                <div class="flex items-center gap-3 mb-6">
                    <div class="relative">
                        <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                        <div class="absolute inset-0 bg-blue-500 rounded-full animate-ping opacity-75"></div>
                    </div>
                    <h3 class="text-sm font-black uppercase text-slate-800 dark:text-white tracking-widest" data-i18n="mon_title">Server Status</h3>
                </div>

                <div class="flex flex-col md:flex-row gap-4">
                    <input type="text" id="server-ip-input" placeholder="IP Adresse (z.B. hypixel.net)" class="flex-1 bg-slate-50 dark:bg-slate-800 px-5 py-4 rounded-xl border border-slate-200 dark:border-slate-700 outline-none font-bold text-sm focus:border-blue-500 transition-colors">
                    <button onclick="monitor.startScan()" class="bg-blue-600 text-white px-8 py-4 rounded-xl font-bold uppercase text-xs tracking-widest hover:bg-blue-500 transition-colors shadow-lg shadow-blue-500/20" data-i18n="btn_check">
                        Check
                    </button>
                </div>
            </div>

            <div id="monitor-result-container" class="transition-all duration-300">
                </div>
        </div>

        <div id="page-admin" class="page-hidden space-y-6 fade-in">
            <div class="flex items-center justify-between mb-2">
                <h2 class="text-xl font-black uppercase text-slate-800 dark:text-white" data-i18n="admin_title">Datenbank</h2>
                <div class="px-3 py-1 rounded bg-emerald-500/10 text-emerald-500 border border-emerald-500/20 text-[10px] font-black uppercase tracking-widest">
                    Secure
                </div>
            </div>
            
            <div id="admin-user-list" class="space-y-4">
                </div>
        </div>

    </div>

    <div id="modal-backdrop" class="hidden fixed inset-0 bg-black/80 backdrop-blur-md z-[100] flex items-center justify-center p-4 transition-opacity duration-300">
        <div class="bg-white dark:bg-slate-900 w-full max-w-md p-8 rounded-[1.5rem] border border-slate-200 dark:border-slate-800 shadow-2xl transform transition-all scale-100">
            
            <div id="modal-manual" class="hidden space-y-6">
                <div class="text-center mb-6">
                    <h3 class="text-lg font-black uppercase tracking-widest text-slate-900 dark:text-white" data-i18n="mod_title">Neuer Eintrag</h3>
                    <div class="h-1 w-12 bg-blue-500 mx-auto mt-2 rounded-full"></div>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-2 ml-1">Beschreibung</label>
                        <input type="text" id="input-desc" class="w-full bg-slate-50 dark:bg-slate-800 p-4 rounded-xl outline-none font-bold text-sm border border-transparent focus:border-blue-500 transition-colors">
                    </div>
                    
                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-2 ml-1">Betrag (Euro)</label>
                        <input type="number" id="input-amount" placeholder="0.00" class="w-full bg-slate-50 dark:bg-slate-800 p-4 rounded-xl outline-none font-mono font-bold text-xl text-center border border-transparent focus:border-blue-500 transition-colors">
                    </div>

                    <div>
                        <label class="block text-[10px] font-bold text-slate-400 uppercase mb-2 ml-1">Kategorie</label>
                        <select id="input-type" class="w-full bg-slate-50 dark:bg-slate-800 p-4 rounded-xl font-bold text-sm outline-none border border-transparent focus:border-blue-500 cursor-pointer appearance-none">
                            <option value="once" data-i18n="opt_once">Einmalig</option>
                            <option value="monthly" data-i18n="opt_monthly">Monatlich</option>
                            <option value="income" data-i18n="opt_income">Einnahme (+)</option>
                        </select>
                    </div>
                </div>

                <button onclick="logic.saveEntry()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-black uppercase text-xs tracking-[0.2em] shadow-lg hover:bg-blue-500 transition-all" data-i18n="btn_save">
                    Speichern
                </button>
            </div>

            <div id="modal-import" class="hidden space-y-6 text-center">
                <div class="text-center mb-6">
                    <h3 class="text-lg font-black uppercase tracking-widest text-slate-900 dark:text-white">AI Smart Scan</h3>
                    <div class="h-1 w-12 bg-blue-500 mx-auto mt-2 rounded-full"></div>
                </div>
                
                <div class="relative w-full">
                    <input type="file" id="pdf-file-input" accept=".pdf" class="hidden" onchange="logic.handleFileSelect(this)">
                    
                    <label for="pdf-file-input" class="group flex flex-col items-center justify-center w-full h-40 border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-2xl cursor-pointer hover:border-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/10 transition-all">
                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                            <svg class="w-10 h-10 mb-3 text-slate-400 group-hover:text-blue-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                            <p id="file-label-text" class="mb-2 text-sm font-bold text-slate-500 dark:text-slate-400" data-i18n="lbl_select_file">PDF Datei auswählen</p>
                        </div>
                    </label>
                </div>

                <div id="scan-status" class="text-xs font-bold text-blue-500 hidden">Analysiere Dokument...</div>

                <button onclick="logic.runSmartScan()" class="w-full bg-slate-900 dark:bg-white dark:text-slate-900 text-white py-4 rounded-xl font-black uppercase text-xs tracking-[0.2em] shadow-lg hover:opacity-90 transition-all" data-i18n="btn_start_scan">
                    Scan Starten
                </button>
            </div>

            <button onclick="ui.closeModal()" class="w-full mt-2 py-3 text-slate-400 font-bold text-[10px] uppercase tracking-[0.3em] hover:text-rose-500 transition-colors" data-i18n="btn_cancel">
                Abbrechen
            </button>
        </div>
    </div>

    <script>
        /* 1. ÜBERSETZUNGS-DATENBANK
           Hier werden alle Texte für Deutsch/Englisch gespeichert.
        */
        const translations = {
            de: {
                nav_dash: "Dashboard",
                nav_monitor: "Server Monitor",
                nav_admin: "Admin Panel",
                theme_label: "Dark Mode",
                card_balance: "Aktuelle Bilanz",
                card_costs: "Fixkosten",
                btn_entry: "Eintrag",
                btn_scan: "Smart Scan",
                mon_title: "Server Status",
                btn_check: "Check",
                admin_title: "Datenbank",
                mod_title: "Neuer Eintrag",
                btn_save: "Speichern",
                btn_cancel: "Abbrechen",
                opt_once: "Einmalig",
                opt_monthly: "Monatlich",
                opt_income: "Einnahme (+)",
                lbl_select_file: "Klicken um PDF zu wählen",
                btn_start_scan: "Scan Starten"
            },
            en: {
                nav_dash: "Dashboard",
                nav_monitor: "Monitor",
                nav_admin: "Admin",
                theme_label: "Dark Mode",
                card_balance: "Balance",
                card_costs: "Fixed Costs",
                btn_entry: "Entry",
                btn_scan: "Smart Scan",
                mon_title: "Server Status",
                btn_check: "Check",
                admin_title: "Database",
                mod_title: "New Entry",
                btn_save: "Save",
                btn_cancel: "Cancel",
                opt_once: "One-time",
                opt_monthly: "Monthly",
                opt_income: "Income (+)",
                lbl_select_file: "Click to select PDF",
                btn_start_scan: "Start Scan"
            }
        };

        /* 2. STATE MANAGEMENT (DATENSPEICHERUNG)
           Lädt Daten aus dem LocalStorage oder setzt Standardwerte.
        */
        let appState = JSON.parse(localStorage.getItem('vultrex_data_v9')) || {
            history: [],
            lang: 'de',
            darkMode: true,
            // Nur noch der Admin User, keine Moderatoren mehr
            users: [
                { name: 'Administrator', role: 'System Owner', pin: '1234' }
            ]
        };

        let financeChart = null;

        /* 3. UI CONTROLLER 
           Kümmert sich um alles, was man sieht.
        */
        const ui = {
            // Speichert den aktuellen Stand im Browser
            persistData() {
                localStorage.setItem('vultrex_data_v9', JSON.stringify(appState));
            },

            // Theme umschalten (Light/Dark)
            toggleTheme() {
                const checkBox = document.getElementById('theme-toggle');
                appState.darkMode = checkBox.checked;
                
                if (appState.darkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                this.persistData();
            },

            // Sprache setzen
            setLanguage(langCode) {
                appState.lang = langCode;
                const texts = translations[langCode];
                
                // Alle Elemente mit data-i18n Attribut suchen und übersetzen
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if(texts[key]) el.innerText = texts[key];
                });

                // Auch den Placeholder vom IP Input anpassen
                const ipInput = document.getElementById('server-ip-input');
                if(ipInput) {
                    ipInput.placeholder = langCode === 'de' ? "IP Adresse (z.B. hypixel.net)" : "IP Address (e.g. hypixel.net)";
                }

                this.persistData();
            },

            // Sidebar ein/ausblenden
            toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('overlay');
                const isClosed = sidebar.classList.contains('-translate-x-full');
                
                if (isClosed) {
                    // Öffnen
                    sidebar.classList.remove('-translate-x-full');
                    overlay.classList.remove('hidden');
                    // Kleiner Timeout für Fade-In Effekt
                    setTimeout(() => overlay.classList.remove('opacity-0'), 10);
                } else {
                    // Schließen
                    sidebar.classList.add('-translate-x-full');
                    overlay.classList.add('opacity-0');
                    setTimeout(() => overlay.classList.add('hidden'), 300);
                }
            },

            // Seitenwechsel Logik
            switchPage(pageId) {
                // Alle Seiten verstecken
                ['dashboard', 'monitor', 'admin'].forEach(id => {
                    document.getElementById('page-' + id).classList.add('page-hidden');
                });
                
                // Gewünschte Seite zeigen
                document.getElementById('page-' + pageId).classList.remove('page-hidden');
                
                // Falls Admin Panel, Liste neu rendern
                if(pageId === 'admin') {
                    this.renderAdminList();
                }

                // Sidebar auf Mobile automatisch schließen
                const sidebar = document.getElementById('sidebar');
                if(!sidebar.classList.contains('-translate-x-full')) {
                    this.toggleSidebar();
                }
            },

            // Modal Öffnen
            openModal(type) {
                const bg = document.getElementById('modal-backdrop');
                const manualForm = document.getElementById('modal-manual');
                const importForm = document.getElementById('modal-import');
                
                // Reset Forms
                manualForm.classList.add('hidden');
                importForm.classList.add('hidden');
                
                if(type === 'manual') manualForm.classList.remove('hidden');
                if(type === 'import') {
                    importForm.classList.remove('hidden');
                    // Reset File Input Text
                    document.getElementById('file-label-text').innerText = translations[appState.lang].lbl_select_file;
                    document.getElementById('pdf-file-input').value = "";
                }
                
                bg.classList.remove('hidden');
            },

            // Modal Schließen
            closeModal() {
                document.getElementById('modal-backdrop').classList.add('hidden');
                // Felder leeren
                document.getElementById('input-desc').value = "";
                document.getElementById('input-amount').value = "";
            },

            // Admin PIN Abfrage
            openAdminPin() {
                // Einfache Prompt Abfrage
                const pin = prompt(appState.lang === 'de' ? "Sicherheitscode:" : "Security Code:");
                if(pin === "1234") {
                    this.switchPage('admin');
                } else if(pin !== null) {
                    alert("Zugriff verweigert / Access Denied");
                }
            },

            // Admin Liste Rendern
            renderAdminList() {
                const container = document.getElementById('admin-user-list');
                container.innerHTML = appState.users.map(user => `
                    <div class="v-card flex justify-between items-center p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-lg bg-slate-100 dark:bg-slate-800 flex items-center justify-center font-bold text-slate-600 dark:text-slate-300">
                                ${user.name.charAt(0)}
                            </div>
                            <div>
                                <p class="font-bold text-slate-900 dark:text-white">${user.name}</p>
                                <p class="text-[10px] font-black text-blue-500 uppercase tracking-widest">${user.role}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-[10px] uppercase text-slate-400 font-bold mr-2">PIN</span>
                            <span class="font-mono bg-slate-100 dark:bg-slate-950 px-3 py-1 rounded text-xs border border-slate-200 dark:border-slate-800">
                                ${user.pin}
                            </span>
                        </div>
                    </div>
                `).join('');
            },

            // Dashboard Aktualisieren
            refreshDashboard() {
                const list = document.getElementById('transaction-list');
                list.innerHTML = ''; // Liste leeren
                
                let balance = 0;
                let fixCosts = 0;

                // Sortieren nach Datum (Neueste zuerst)
                const sortedHistory = [...appState.history].sort((a,b) => b.id - a.id);

                sortedHistory.forEach(item => {
                    balance += item.amount;
                    if(item.amount < 0 && item.type === 'monthly') {
                        fixCosts += Math.abs(item.amount);
                    }

                    // Element erstellen
                    const div = document.createElement('div');
                    // Design: Sehr clean, keine Emojis
                    div.className = "v-card flex justify-between items-center p-4 hover:border-blue-500/50 transition-colors group";
                    
                    const isNeg = item.amount < 0;
                    const colorClass = isNeg ? 'text-rose-500' : 'text-emerald-500';
                    const barColor = isNeg ? 'bg-rose-500' : 'bg-emerald-500';

                    div.innerHTML = `
                        <div class="flex items-center gap-4">
                            <div class="w-1 h-10 rounded-full ${barColor}"></div>
                            <div>
                                <p class="font-bold text-sm text-slate-800 dark:text-slate-200">${item.desc}</p>
                                <div class="flex gap-2 text-[10px] font-bold text-slate-400 uppercase mt-1">
                                    <span>${item.date}</span>
                                    <span class="text-slate-300 dark:text-slate-600">•</span>
                                    <span>${item.type}</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <span class="font-mono font-bold text-lg ${colorClass}">${item.amount.toFixed(2)} €</span>
                            <button onclick="logic.deleteEntry(${item.id})" class="w-8 h-8 flex items-center justify-center rounded-lg text-slate-300 hover:text-rose-500 hover:bg-rose-50 dark:hover:bg-rose-900/20 transition-all opacity-0 group-hover:opacity-100">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            </button>
                        </div>
                    `;
                    list.appendChild(div);
                });

                // Texte aktualisieren
                document.getElementById('balance-display').innerText = balance.toFixed(2) + " €";
                document.getElementById('costs-display').innerText = fixCosts.toFixed(2) + " €";

                this.updateChart();
            },

            // Chart Zeichnen
            updateChart() {
                if(!financeChart) return;

                // Daten für Chart vorbereiten (Chronologisch aufsteigend)
                const chronoHistory = [...appState.history].sort((a,b) => a.id - b.id);
                
                let runningTotal = 0;
                const dataPoints = chronoHistory.map(item => {
                    runningTotal += item.amount;
                    return runningTotal;
                });
                
                const labels = chronoHistory.map(item => item.date);

                financeChart.data.labels = labels;
                financeChart.data.datasets[0].data = dataPoints;
                financeChart.update();
            }
        };

        /* 4. BUSINESS LOGIC
           Verarbeitet Eingaben, speichert Daten, führt Scans aus.
        */
        const logic = {
            // Speichert manuellen Eintrag
            saveEntry() {
                const desc = document.getElementById('input-desc').value || 'Unbenannt';
                let amount = parseFloat(document.getElementById('input-amount').value);
                const type = document.getElementById('input-type').value;

                if(isNaN(amount)) {
                    alert("Bitte eine Zahl eingeben!");
                    return;
                }

                // Wenn keine Einnahme, dann negativ
                if(type !== 'income') {
                    amount = -Math.abs(amount);
                }

                // Datensatz erstellen
                const entry = {
                    id: Date.now(),
                    desc: desc,
                    amount: amount,
                    type: type,
                    date: new Date().toLocaleDateString('de-DE', {day: '2-digit', month: '2-digit'})
                };

                appState.history.push(entry);
                ui.persistData();
                ui.closeModal();
                ui.refreshDashboard();
            },

            // Eintrag löschen
            deleteEntry(id) {
                if(confirm("Eintrag wirklich löschen?")) {
                    appState.history = appState.history.filter(item => item.id !== id);
                    ui.persistData();
                    ui.refreshDashboard();
                }
            },

            // Datei Auswahl Anzeige aktualisieren
            handleFileSelect(input) {
                if(input.files && input.files[0]) {
                    document.getElementById('file-label-text').innerText = input.files[0].name;
                    document.getElementById('file-label-text').classList.add('text-blue-500');
                }
            },

            // PDF Smart Scan Logik
            runSmartScan() {
                const fileInput = document.getElementById('pdf-file-input');
                if(!fileInput.files || !fileInput.files[0]) {
                    alert("Bitte erst eine PDF auswählen!");
                    return;
                }

                // Lade-Animation simulieren
                const statusDiv = document.getElementById('scan-status');
                statusDiv.classList.remove('hidden');

                setTimeout(() => {
                    // *** WICHTIG: Hier ist der feste Wert -5.00 Euro ***
                    const detectedAmount = -5.00;
                    
                    const entry = {
                        id: Date.now(),
                        desc: "Smart Scan (PDF)",
                        amount: detectedAmount,
                        type: "once",
                        date: new Date().toLocaleDateString('de-DE', {day: '2-digit', month: '2-digit'})
                    };

                    appState.history.push(entry);
                    ui.persistData();
                    ui.closeModal();
                    ui.refreshDashboard();
                    
                    statusDiv.classList.add('hidden');
                    alert("Scan erfolgreich! Betrag von -5,00 € erkannt.");

                }, 1500); // 1.5 Sekunden Fake-Ladezeit
            }
        };

        /* 5. SERVER MONITOR LOGIC
        */
        const monitor = {
            async startScan() {
                const ipInput = document.getElementById('server-ip-input');
                const resultBox = document.getElementById('monitor-result-container');
                const ip = ipInput.value.trim();

                if(!ip) return;

                // Loading State
                resultBox.innerHTML = `
                    <div class="v-card text-center p-8">
                        <div class="inline-block w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-2"></div>
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-widest">Verbinde mit Server...</p>
                    </div>
                `;

                try {
                    const response = await fetch(`https://api.mcstatus.io/v2/status/java/${ip}`);
                    const data = await response.json();

                    if(data.online) {
                        resultBox.innerHTML = `
                            <div class="v-card animate-in fade-in slide-in-from-bottom-4">
                                <div class="flex flex-col md:flex-row gap-6 items-start">
                                    <img src="${data.icon}" class="w-20 h-20 rounded-xl shadow-md border border-slate-200 dark:border-slate-700" style="image-rendering: pixelated;">
                                    
                                    <div class="flex-1 w-full">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <h4 class="text-xl font-black text-slate-900 dark:text-white">${ip}</h4>
                                                <div class="flex items-center gap-2 mt-1">
                                                    <span class="relative flex h-2 w-2">
                                                      <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                                                      <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                                                    </span>
                                                    <span class="text-xs font-bold text-emerald-500 uppercase tracking-widest">Online</span>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                 <div class="bg-slate-100 dark:bg-slate-800 px-3 py-2 rounded-lg border border-slate-200 dark:border-slate-700">
                                                    <p class="text-[9px] font-black uppercase text-slate-400 mb-1">Spieler</p>
                                                    <p class="text-lg font-bold text-slate-800 dark:text-white font-mono">${data.players.online} <span class="text-slate-400 text-sm">/ ${data.players.max}</span></p>
                                                 </div>
                                            </div>
                                        </div>

                                        <div class="bg-slate-900 p-4 rounded-lg border border-slate-700 mt-4 overflow-hidden">
                                            <div class="mc-font text-white text-sm leading-relaxed whitespace-pre-wrap">${data.motd.html}</div>
                                        </div>
                                        
                                        <div class="mt-2 text-right">
                                            <span class="text-[10px] font-mono text-slate-400">v${data.version.name_clean}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        resultBox.innerHTML = `
                            <div class="v-card border-rose-500/20 bg-rose-500/5 text-center p-8">
                                <p class="text-3xl mb-2">❌</p>
                                <p class="font-black text-rose-500 uppercase tracking-widest">Server Offline</p>
                            </div>
                        `;
                    }
                } catch(e) {
                    resultBox.innerHTML = `<div class="v-card p-4 text-center text-rose-500 font-bold">API Fehler</div>`;
                }
            }
        };

        /* 6. INITIALISIERUNG
           Wird ausgeführt, sobald die Seite geladen ist.
        */
        window.onload = function() {
            // 1. Theme setzen
            const toggle = document.getElementById('theme-toggle');
            toggle.checked = appState.darkMode;
            if(appState.darkMode) document.documentElement.classList.add('dark');
            else document.documentElement.classList.remove('dark');

            // 2. Sprache setzen
            document.getElementById('lang-select').value = appState.lang;
            ui.setLanguage(appState.lang);

            // 3. Chart Initialisieren
            const ctx = document.getElementById('financeChart').getContext('2d');
            financeChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Verlauf',
                        data: [],
                        borderColor: '#3b82f6', // Blau
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        pointBackgroundColor: '#ffffff',
                        pointBorderColor: '#3b82f6',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        tension: 0.4, // Kurvige Linien
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }, // Legende verstecken
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: '#1e293b',
                            titleFont: { family: 'Inter', size: 13 },
                            bodyFont: { family: 'Inter', size: 13, weight: 'bold' },
                            padding: 10,
                            displayColors: false
                        }
                    },
                    scales: {
                        x: { display: false }, // Keine X-Achse Beschriftung
                        y: {
                            ticks: {
                                // *** HIER IST DER FIX FÜR DIE SKALIERUNG ***
                                stepSize: 2.0, // Erzwingt 2er Schritte
                                color: '#94a3b8',
                                font: { family: 'JetBrains Mono', size: 10 }
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)',
                                borderDash: [4, 4]
                            },
                            beginAtZero: true
                        }
                    }
                }
            });

            // 4. Dashboard das erste Mal laden
            ui.refreshDashboard();
        };

    </script>
</body>
</html>
