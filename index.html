<!DOCTYPE html>
<html lang="de" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vultrex Pro | Enterprise System V7</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            900: '#1e3a8a',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* =========================================
           GLOBAL IMPORTS & FONTS
           ========================================= */
        @import url('https://fonts.cdnfonts.com/css/minecraft-4');
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');

        /* =========================================
           CORE VARIABLES & RESETS
           ========================================= */
        :root {
            --transition-speed: 0.3s;
            --sidebar-width: 280px;
        }

        body {
            transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
            overflow-x: hidden;
        }

        /* =========================================
           CUSTOM SCROLLBAR
           ========================================= */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #334155;
        }

        /* =========================================
           UTILITY CLASSES (NON-TAILWIND)
           ========================================= */
        .mc-font {
            font-family: 'Minecraft', sans-serif !important;
            text-shadow: 2px 2px 0px #000000;
            letter-spacing: 1px;
        }

        .pixel-box {
            image-rendering: pixelated;
        }

        .page-hidden {
            display: none !important;
        }

        /* =========================================
           COMPONENT: CARDS & CONTAINERS
           ========================================= */
        /* Hier wurde das Padding reduziert (Fix f√ºr Zoom-Problem) */
        .v-card {
            background-color: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 1.5rem; /* 24px */
            padding: 1.5rem;       /* 24px statt 48px */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease-in-out;
            position: relative;
            overflow: hidden;
        }

        .dark .v-card {
            background-color: #0f172a; /* Slate 900 */
            border-color: #1e293b;     /* Slate 800 */
        }

        .v-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border-color: rgba(59, 130, 246, 0.5); /* Blue border on hover */
        }

        /* =========================================
           COMPONENT: TOGGLE SWITCH
           ========================================= */
        .switch {
            position: relative;
            display: inline-block;
            width: 52px;
            height: 28px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        input:checked + .slider {
            background-color: #3b82f6;
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        .dark .slider {
            background-color: #334155;
        }

        /* =========================================
           COMPONENT: SIDEBAR ANIMATION
           ========================================= */
        .sidebar-container {
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .overlay-fade {
            transition: opacity 0.3s ease;
        }

        /* =========================================
           MINECRAFT SERVER STATUS STYLES
           ========================================= */
        .motd-container {
            background-color: #0f172a;
            border: 2px solid #334155;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Minecraft', monospace;
            color: #ffffff;
            line-height: 1.5;
            white-space: pre-wrap;
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 min-h-screen font-sans selection:bg-blue-500 selection:text-white">

    <div id="sidebar" class="sidebar-container fixed inset-y-0 left-0 w-[280px] bg-white dark:bg-slate-900 z-[60] border-r border-slate-200 dark:border-slate-800 shadow-2xl -translate-x-full">
        <div class="flex flex-col h-full p-6">
            
            <div class="flex items-center gap-4 mb-12">
                <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-700 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/20 text-white font-black text-2xl italic transform -rotate-3">
                    V
                </div>
                <div>
                    <h1 class="text-xl font-black italic tracking-tighter text-slate-900 dark:text-white uppercase">
                        Vultrex
                    </h1>
                    <span class="text-[10px] font-bold text-blue-500 uppercase tracking-[0.2em]">Enterprise</span>
                </div>
            </div>

            <nav class="space-y-3 flex-1">
                <button onclick="ui.switchPage('dashboard')" class="w-full text-left px-4 py-4 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 font-bold flex items-center gap-4 transition-all group">
                    <span class="text-xl group-hover:scale-110 transition-transform">üìä</span>
                    <span data-i18n="nav_dash">Dashboard</span>
                </button>

                <button onclick="ui.switchPage('monitor')" class="w-full text-left px-4 py-4 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 font-bold flex items-center gap-4 transition-all group">
                    <span class="text-xl group-hover:scale-110 transition-transform">üéÆ</span>
                    <span data-i18n="nav_monitor">Server Monitor</span>
                </button>

                <button onclick="ui.openAdminPin()" class="w-full text-left px-4 py-4 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-800 font-bold flex items-center gap-4 transition-all group">
                    <span class="text-xl group-hover:scale-110 transition-transform">üîí</span>
                    <span data-i18n="nav_admin">Admin Panel</span>
                </button>
            </nav>

            <div class="pt-6 mt-6 border-t border-slate-100 dark:border-slate-800">
                <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-6">System Settings</p>
                
                <div class="flex items-center justify-between mb-6 px-2">
                    <span class="text-xs font-bold text-slate-600 dark:text-slate-300" data-i18n="theme_label">Dark Mode</span>
                    <label class="switch">
                        <input type="checkbox" id="theme-toggle" onchange="ui.toggleTheme()">
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="relative px-2">
                    <label class="text-[10px] font-bold text-slate-400 uppercase mb-2 block">Language</label>
                    <select onchange="ui.setLanguage(this.value)" id="lang-select" class="w-full bg-slate-100 dark:bg-slate-800 p-3 rounded-lg text-xs font-bold outline-none border border-slate-200 dark:border-slate-700 focus:border-blue-500 transition-colors appearance-none cursor-pointer">
                        <option value="de">Deutsch</option>
                        <option value="en">English</option>
                        <option value="fr">Fran√ßais</option>
                    </select>
                    <div class="absolute right-5 bottom-3 pointer-events-none text-[10px] opacity-50">‚ñº</div>
                </div>
            </div>
        </div>
    </div>

    <div id="sidebar-overlay" onclick="ui.toggleSidebar()" class="fixed inset-0 bg-black/60 z-[55] hidden backdrop-blur-sm overlay-fade"></div>

    <div class="max-w-5xl mx-auto p-4 md:p-8 min-h-screen flex flex-col">
        
        <header class="flex justify-between items-center mb-10 mt-2">
            <button onclick="ui.toggleSidebar()" class="w-12 h-12 flex items-center justify-center bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800 shadow-sm hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
                <span class="text-2xl leading-none">‚ò∞</span>
            </button>
            
            <div class="flex items-center gap-3">
                <span class="text-2xl font-black italic text-blue-600 tracking-tighter uppercase">Vultrex</span>
                <span class="px-2 py-1 rounded bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 text-[10px] font-black uppercase tracking-widest">Pro</span>
            </div>
            
            <div class="w-12"></div>
        </header>

        <div id="page-dashboard" class="space-y-6 flex-1">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="v-card group">
                    <div class="flex justify-between items-start mb-2">
                        <p class="text-[11px] font-black text-slate-400 uppercase tracking-[0.2em]" data-i18n="card_balance">Gesamtbilanz</p>
                        <div class="p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-blue-600">üí∞</div>
                    </div>
                    <p id="balance-display" class="text-4xl font-black text-slate-900 dark:text-white tracking-tighter">0.00 ‚Ç¨</p>
                </div>

                <div class="v-card group">
                    <div class="flex justify-between items-start mb-2">
                        <p class="text-[11px] font-black text-rose-500 uppercase tracking-[0.2em]" data-i18n="card_costs">Fixkosten</p>
                        <div class="p-2 bg-rose-50 dark:bg-rose-900/20 rounded-lg text-rose-500">üìâ</div>
                    </div>
                    <p id="costs-display" class="text-4xl font-black text-rose-500 tracking-tighter">0.00 ‚Ç¨</p>
                </div>
            </div>

            <div class="v-card">
                <div class="h-[250px] w-full">
                    <canvas id="financeChart"></canvas>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <button onclick="ui.openModal('manual')" class="bg-blue-600 text-white py-4 rounded-xl font-black uppercase text-xs tracking-[0.2em] shadow-lg shadow-blue-500/25 hover:bg-blue-500 hover:scale-[1.02] active:scale-95 transition-all" data-i18n="btn_entry">
                    Neuer Eintrag
                </button>
                <button onclick="ui.openModal('import')" class="bg-slate-900 dark:bg-white dark:text-slate-900 text-white py-4 rounded-xl font-black uppercase text-xs tracking-[0.2em] shadow-lg hover:scale-[1.02] active:scale-95 transition-all flex items-center justify-center gap-2" data-i18n="btn_scan">
                    <span>‚ö°</span> Smart Scan
                </button>
            </div>

            <div class="mt-8">
                <h3 class="text-sm font-bold text-slate-400 uppercase tracking-widest mb-4 ml-1">Verlauf</h3>
                <div id="transaction-list" class="space-y-3 pb-20">
                    </div>
            </div>
        </div>

        <div id="page-monitor" class="page-hidden space-y-6">
            <div class="v-card">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></div>
                    <h3 class="text-lg font-black uppercase text-blue-600 tracking-wide" data-i18n="mon_title">Server Tracking</h3>
                </div>

                <div class="relative mb-4">
                    <input type="text" id="minecraft-ip" placeholder="Server IP (z.B. hypixel.net)" class="w-full bg-slate-50 dark:bg-slate-800 p-4 pl-5 rounded-xl border border-slate-200 dark:border-slate-700 outline-none font-bold focus:border-blue-500 focus:ring-4 focus:ring-blue-500/10 transition-all">
                </div>
                
                <button onclick="monitor.startScan()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-black uppercase text-xs tracking-[0.2em] hover:bg-blue-500 transition-colors" data-i18n="btn_scan_srv">
                    Scan Starten
                </button>
            </div>

            <div id="monitor-result" class="transition-all duration-500 ease-in-out"></div>
        </div>

        <div id="page-admin" class="page-hidden space-y-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-black uppercase text-slate-800 dark:text-white" data-i18n="admin_title">Benutzer-Datenbank</h2>
                <div class="px-3 py-1 bg-emerald-500/10 text-emerald-500 rounded-full text-[10px] font-black uppercase tracking-widest border border-emerald-500/20">
                    Secure
                </div>
            </div>
            
            <div id="admin-user-grid" class="grid grid-cols-1 gap-4">
                </div>
        </div>
    </div>

    <div id="modal-backdrop" class="hidden fixed inset-0 bg-black/80 backdrop-blur-md z-[100] flex items-center justify-center p-4 transition-opacity duration-300">
        <div class="bg-white dark:bg-slate-900 w-full max-w-lg p-8 rounded-[2rem] border border-slate-200 dark:border-slate-800 shadow-2xl relative transform transition-all scale-100">
            
            <div id="modal-manual" class="hidden space-y-6 text-center">
                <div class="w-16 h-16 bg-blue-50 dark:bg-blue-900/20 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl">
                    ‚úçÔ∏è
                </div>
                <h3 class="text-2xl font-black text-slate-900 dark:text-white uppercase italic" data-i18n="mod_title">Finanz-Eintrag</h3>
                
                <div class="space-y-4">
                    <input type="text" id="input-desc" placeholder="Beschreibung" class="w-full bg-slate-100 dark:bg-slate-800 p-4 rounded-xl outline-none font-bold border border-transparent focus:border-blue-500 transition-colors text-center">
                    
                    <div class="relative">
                        <input type="number" id="input-amount" placeholder="0.00" class="w-full bg-slate-100 dark:bg-slate-800 p-4 rounded-xl outline-none font-black text-3xl text-center focus:bg-white dark:focus:bg-slate-950 border border-transparent focus:border-slate-200 dark:focus:border-slate-700 transition-all">
                        <span class="absolute right-6 top-1/2 -translate-y-1/2 font-bold text-slate-400">‚Ç¨</span>
                    </div>

                    <select id="input-type" class="w-full bg-slate-100 dark:bg-slate-800 p-4 rounded-xl font-bold border border-transparent cursor-pointer outline-none text-center appearance-none">
                        <option value="once" data-i18n="opt_once">Einmalige Kosten</option>
                        <option value="monthly" data-i18n="opt_monthly">Monatliches Abo</option>
                        <option value="income" data-i18n="opt_income">Einnahme (+)</option>
                    </select>
                </div>

                <button onclick="logic.saveEntry()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-black uppercase tracking-[0.2em] shadow-xl hover:bg-blue-500 active:scale-95 transition-all" data-i18n="btn_save">
                    Speichern
                </button>
            </div>

            <div id="modal-import" class="hidden space-y-6 text-center">
                <div class="w-16 h-16 bg-blue-50 dark:bg-blue-900/20 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl">
                    ü§ñ
                </div>
                <h3 class="text-2xl font-black text-slate-900 dark:text-white uppercase italic">AI Smart Scan</h3>
                
                <div class="p-10 border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-3xl hover:border-blue-500 transition-colors bg-slate-50 dark:bg-slate-800/50">
                    <input type="file" id="pdf-upload" accept=".pdf" class="block w-full text-sm text-slate-500
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-full file:border-0
                        file:text-xs file:font-semibold
                        file:bg-blue-50 file:text-blue-700
                        hover:file:bg-blue-100 cursor-pointer
                    "/>
                </div>

                <button onclick="logic.runPDFScan()" class="w-full bg-slate-900 dark:bg-white dark:text-slate-900 text-white py-4 rounded-xl font-black uppercase tracking-[0.2em] shadow-xl hover:opacity-90 active:scale-95 transition-all" data-i18n="btn_start">
                    Scan Starten
                </button>
            </div>

            <button onclick="ui.closeModal()" class="w-full mt-4 py-3 text-slate-400 font-bold text-[10px] uppercase tracking-[0.3em] hover:text-rose-500 transition-colors" data-i18n="btn_cancel">
                Abbrechen & Schlie√üen
            </button>
        </div>
    </div>

    <script>
        // Set worker source for PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        /* --- TRANSLATION DATA --- */
        const i18n = {
            de: {
                nav_dash: "Dashboard",
                nav_monitor: "Server Monitor",
                nav_admin: "Admin Panel",
                theme_label: "Dark Mode",
                card_balance: "Gesamtbilanz",
                card_costs: "Fixkosten",
                btn_entry: "Neuer Eintrag",
                btn_scan: "Smart Scan",
                mon_title: "Server Tracking",
                btn_scan_srv: "Scan Starten",
                admin_title: "Benutzer-Datenbank",
                mod_title: "Finanz-Eintrag",
                btn_save: "Speichern",
                btn_cancel: "Abbrechen",
                btn_start: "Scan Starten",
                opt_once: "Einmalige Kosten",
                opt_monthly: "Monatliches Abo",
                opt_income: "Einnahme (+)"
            },
            en: {
                nav_dash: "Dashboard",
                nav_monitor: "Server Monitor",
                nav_admin: "Admin Panel",
                theme_label: "Dark Mode",
                card_balance: "Total Balance",
                card_costs: "Fixed Costs",
                btn_entry: "New Entry",
                btn_scan: "Smart Scan",
                mon_title: "Server Tracking",
                btn_scan_srv: "Start Scan",
                admin_title: "User Database",
                mod_title: "Finance Entry",
                btn_save: "Save Entry",
                btn_cancel: "Cancel",
                btn_start: "Start Scan",
                opt_once: "One-time Cost",
                opt_monthly: "Subscription",
                opt_income: "Income (+)"
            },
            fr: {
                nav_dash: "Tableau de bord",
                nav_monitor: "Moniteur Serveur",
                nav_admin: "Panneau Admin",
                theme_label: "Mode Sombre",
                card_balance: "Solde Total",
                card_costs: "Frais Fixes",
                btn_entry: "Nouvelle Entr√©e",
                btn_scan: "Scan Intelligent",
                mon_title: "Suivi Serveur",
                btn_scan_srv: "Lancer Scan",
                admin_title: "Base de donn√©es",
                mod_title: "Entr√©e Finance",
                btn_save: "Sauvegarder",
                btn_cancel: "Annuler",
                btn_start: "D√©marrer",
                opt_once: "Co√ªt unique",
                opt_monthly: "Abonnement",
                opt_income: "Revenu (+)"
            }
        };

        /* --- STATE MANAGEMENT --- */
        // Loading state from LocalStorage or creating defaults
        let appState = JSON.parse(localStorage.getItem('vultrex_data_v7')) || {
            history: [],
            lang: 'de',
            darkMode: true,
            users: [
                { name: 'Administrator', role: 'System Owner', pin: '1234' },
                { name: 'Moderator', role: 'Staff', pin: '0000' }
            ]
        };

        // Chart instance variable
        let financeChartInstance = null;

        /* --- UI CONTROLLER --- */
        const ui = {
            // Saves current state to LocalStorage
            persist: function() {
                localStorage.setItem('vultrex_data_v7', JSON.stringify(appState));
            },

            // Handles Theme Switching (Fix applied for HTML tag)
            toggleTheme: function() {
                const checkbox = document.getElementById('theme-toggle');
                appState.darkMode = checkbox.checked;
                
                if (appState.darkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                this.persist();
            },

            // Handles Language Switching
            setLanguage: function(langCode) {
                appState.lang = langCode;
                const texts = i18n[langCode];
                
                // Translate text elements
                document.querySelectorAll('[data-i18n]').forEach(element => {
                    const key = element.getAttribute('data-i18n');
                    if (texts[key]) {
                        element.innerText = texts[key];
                    }
                });
                
                // Translate input placeholders if needed
                if(langCode === 'en') {
                    document.getElementById('minecraft-ip').placeholder = "Server IP (e.g. hypixel.net)";
                } else {
                    document.getElementById('minecraft-ip').placeholder = "Server IP (z.B. hypixel.net)";
                }

                this.persist();
            },

            // Sidebar Toggle Logic
            toggleSidebar: function() {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebar-overlay');
                const isClosed = sidebar.classList.contains('-translate-x-full');
                
                if (isClosed) {
                    sidebar.classList.remove('-translate-x-full');
                    overlay.classList.remove('hidden');
                    // Small delay for fade in
                    setTimeout(() => overlay.classList.remove('opacity-0'), 10);
                } else {
                    sidebar.classList.add('-translate-x-full');
                    overlay.classList.add('opacity-0');
                    setTimeout(() => overlay.classList.add('hidden'), 300);
                }
            },

            // Navigation Logic
            switchPage: function(pageId) {
                // Hide all pages
                ['dashboard', 'monitor', 'admin'].forEach(pid => {
                    document.getElementById('page-' + pid).classList.add('page-hidden');
                });
                
                // Show requested page
                document.getElementById('page-' + pageId).classList.remove('page-hidden');
                
                // Close sidebar on mobile
                const sidebar = document.getElementById('sidebar');
                if (!sidebar.classList.contains('-translate-x-full')) {
                    this.toggleSidebar();
                }

                // Render specific page content if needed
                if (pageId === 'admin') {
                    this.renderAdminList();
                }

                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            },

            // Modal Logic
            openModal: function(type) {
                const modalBg = document.getElementById('modal-backdrop');
                const manualContainer = document.getElementById('modal-manual');
                const importContainer = document.getElementById('modal-import');
                
                manualContainer.classList.add('hidden');
                importContainer.classList.add('hidden');
                
                if (type === 'manual') manualContainer.classList.remove('hidden');
                if (type === 'import') importContainer.classList.remove('hidden');
                
                modalBg.classList.remove('hidden');
            },

            closeModal: function() {
                document.getElementById('modal-backdrop').classList.add('hidden');
                // Clear inputs
                document.getElementById('input-desc').value = '';
                document.getElementById('input-amount').value = '';
            },

            // Admin Authentication
            openAdminPin: function() {
                const enteredPin = prompt("Sicherheitscode eingeben / Enter PIN:");
                if (enteredPin === "1234") {
                    this.switchPage('admin');
                } else if (enteredPin !== null) {
                    alert("Zugriff verweigert / Access Denied");
                }
            },

            // Render Admin User List
            renderAdminList: function() {
                const grid = document.getElementById('admin-user-grid');
                grid.innerHTML = appState.users.map(user => `
                    <div class="v-card flex items-center justify-between p-6">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-slate-100 dark:bg-slate-800 rounded-full flex items-center justify-center font-bold text-lg">
                                ${user.name.charAt(0)}
                            </div>
                            <div>
                                <p class="font-bold text-slate-900 dark:text-white">${user.name}</p>
                                <p class="text-xs font-bold text-blue-500 uppercase tracking-widest">${user.role}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="block text-[9px] font-black uppercase text-slate-400 tracking-widest mb-1">PIN</span>
                            <code class="bg-slate-100 dark:bg-slate-950 px-3 py-1 rounded border border-slate-200 dark:border-slate-800 font-mono text-sm">${user.pin}</code>
                        </div>
                    </div>
                `).join('');
            },

            // Core Dashboard Update Function
            refreshDashboard: function() {
                let currentBalance = 0;
                let monthlyCosts = 0;
                const container = document.getElementById('transaction-list');
                container.innerHTML = ''; // Clear list
                
                // Sort history by ID (Timestamp) descending
                const sortedHistory = [...appState.history].sort((a, b) => b.id - a.id);

                sortedHistory.forEach(item => {
                    // Update calculations
                    currentBalance += item.amount;
                    if (item.type === 'monthly' && item.amount < 0) {
                        monthlyCosts += Math.abs(item.amount);
                    }

                    // Create HTML Element for List
                    const row = document.createElement('div');
                    row.className = "bg-white dark:bg-slate-900/50 p-4 rounded-2xl border border-slate-100 dark:border-slate-800 flex justify-between items-center group hover:border-blue-500/30 transition-colors";
                    
                    const amountColor = item.amount < 0 ? 'text-rose-500' : 'text-emerald-500';
                    const iconColor = item.amount < 0 ? 'bg-rose-500' : 'bg-emerald-500';

                    row.innerHTML = `
                        <div class="flex items-center gap-4">
                            <div class="w-1.5 h-10 rounded-full ${iconColor}"></div>
                            <div>
                                <p class="font-bold text-sm text-slate-800 dark:text-slate-200">${item.desc}</p>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="text-[9px] font-black text-slate-400 uppercase tracking-widest">${item.date}</span>
                                    <span class="text-[9px] font-bold px-1.5 rounded bg-slate-100 dark:bg-slate-800 text-slate-500">${item.type}</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <span class="font-black text-lg ${amountColor}">${item.amount.toFixed(2)} ‚Ç¨</span>
                            <button onclick="logic.deleteEntry(${item.id})" class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-rose-50 dark:hover:bg-rose-900/20 text-slate-300 hover:text-rose-500 transition-all">
                                üóëÔ∏è
                            </button>
                        </div>
                    `;
                    container.appendChild(row);
                });

                // Update DOM text
                document.getElementById('balance-display').innerText = currentBalance.toFixed(2) + " ‚Ç¨";
                document.getElementById('costs-display').innerText = monthlyCosts.toFixed(2) + " ‚Ç¨";

                // Update Chart
                this.updateChartData();
            },

            // Chart Update Logic
            updateChartData: function() {
                if (!financeChartInstance) return;

                // Prepare data arrays
                // We need to sort by date ascending for the chart
                const timeline = [...appState.history].sort((a, b) => a.id - b.id);
                
                let runningTotal = 0;
                const labels = [];
                const dataPoints = [];

                timeline.forEach(t => {
                    runningTotal += t.amount;
                    labels.push(t.date);
                    dataPoints.push(runningTotal);
                });

                financeChartInstance.data.labels = labels;
                financeChartInstance.data.datasets[0].data = dataPoints;
                financeChartInstance.update();
            }
        };

        /* --- BUSINESS LOGIC --- */
        const logic = {
            // Save manual entry
            saveEntry: function() {
                const descInput = document.getElementById('input-desc');
                const amountInput = document.getElementById('input-amount');
                const typeInput = document.getElementById('input-type');

                const desc = descInput.value || 'Unbenannt';
                let amount = parseFloat(amountInput.value);
                const type = typeInput.value;

                if (isNaN(amount)) {
                    alert("Bitte einen g√ºltigen Betrag eingeben.");
                    return;
                }

                // If it's a cost, make it negative
                if (type !== 'income') {
                    amount = -Math.abs(amount);
                }

                // Create record object
                const newRecord = {
                    id: Date.now(),
                    desc: desc,
                    amount: amount,
                    type: type,
                    date: new Date().toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit' })
                };

                appState.history.push(newRecord);
                ui.persist();
                ui.closeModal();
                ui.refreshDashboard();
            },

            // Delete entry
            deleteEntry: function(id) {
                if (confirm("Eintrag wirklich l√∂schen?")) {
                    appState.history = appState.history.filter(item => item.id !== id);
                    ui.persist();
                    ui.refreshDashboard();
                }
            },

            // PDF Simulation Logic
            runPDFScan: function() {
                const fileInput = document.getElementById('pdf-upload');
                if (fileInput.files.length === 0) {
                    alert("Bitte erst eine PDF ausw√§hlen.");
                    return;
                }

                // Simulating processing time
                const btn = document.querySelector('button[data-i18n="btn_start"]');
                const originalText = btn.innerText;
                btn.innerText = "Analyzing...";
                
                setTimeout(() => {
                    // Mock result
                    const extractedAmount = 24.99;
                    const record = {
                        id: Date.now(),
                        desc: "PDF Invoice Scan",
                        amount: -extractedAmount,
                        type: "once",
                        date: new Date().toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit' })
                    };
                    
                    appState.history.push(record);
                    ui.persist();
                    ui.closeModal();
                    ui.refreshDashboard();
                    
                    btn.innerText = originalText;
                    alert("Scan erfolgreich! 24.99‚Ç¨ Rechnung erkannt.");
                }, 1500);
            }
        };

        /* --- MONITOR LOGIC --- */
        const monitor = {
            startScan: async function() {
                const ipInput = document.getElementById('minecraft-ip');
                const resultBox = document.getElementById('monitor-result');
                const ip = ipInput.value;

                if (!ip) return;

                // Loading State
                resultBox.innerHTML = `
                    <div class="v-card text-center p-12">
                        <div class="inline-block w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"></div>
                        <p class="font-bold text-slate-400 uppercase tracking-widest text-xs">Pinging Server...</p>
                    </div>
                `;

                try {
                    // Fetch Data from API
                    const response = await fetch(`https://api.mcstatus.io/v2/status/java/${ip}`);
                    const data = await response.json();

                    if (data.online) {
                        resultBox.innerHTML = `
                            <div class="v-card animate-in fade-in slide-in-from-bottom-4 duration-500">
                                <div class="flex flex-col md:flex-row gap-6 items-start">
                                    <img src="${data.icon || 'https://via.placeholder.com/64'}" class="w-24 h-24 rounded-2xl shadow-lg border-2 border-slate-100 dark:border-slate-700 pixel-box">
                                    
                                    <div class="flex-1 w-full">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <h4 class="text-2xl font-black text-blue-600 tracking-tight mb-1">${ip}</h4>
                                                <div class="flex items-center gap-2">
                                                    <span class="w-2.5 h-2.5 bg-emerald-500 rounded-full shadow-[0_0_8px_#10b981]"></span>
                                                    <span class="text-xs font-black text-emerald-500 uppercase tracking-widest">Online</span>
                                                </div>
                                            </div>
                                            <div class="text-right bg-slate-100 dark:bg-slate-800 px-4 py-2 rounded-lg">
                                                <p class="text-[9px] font-black uppercase text-slate-400 mb-1">Players</p>
                                                <p class="text-xl font-black text-slate-800 dark:text-white">${data.players.online} <span class="text-slate-400 text-sm">/ ${data.players.max}</span></p>
                                            </div>
                                        </div>

                                        <div class="mt-6 motd-container text-sm">
                                            ${data.motd.html}
                                        </div>
                                        
                                        <p class="mt-4 text-[10px] font-mono text-slate-400 text-right">v${data.version.name_clean}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        resultBox.innerHTML = `
                            <div class="v-card border-rose-500/20 bg-rose-500/5 text-center p-8">
                                <p class="text-4xl mb-2">‚ùå</p>
                                <p class="font-black text-rose-500 uppercase tracking-widest">Server Offline</p>
                            </div>
                        `;
                    }
                } catch (error) {
                    resultBox.innerHTML = `<div class="v-card p-4 text-center text-rose-500 font-bold">API Error: ${error.message}</div>`;
                }
            }
        };

        /* --- INITIALIZATION --- */
        window.onload = function() {
            // 1. Initialize Theme
            const toggle = document.getElementById('theme-toggle');
            toggle.checked = appState.darkMode;
            if (appState.darkMode) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }

            // 2. Initialize Language
            document.getElementById('lang-select').value = appState.lang;
            ui.setLanguage(appState.lang);

            // 3. Initialize Chart
            const ctx = document.getElementById('financeChart').getContext('2d');
            financeChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Balance History',
                        data: [],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#2563eb',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#0f172a',
                            titleFont: { family: 'Inter', size: 13 },
                            bodyFont: { family: 'Inter', size: 13 },
                            padding: 12,
                            cornerRadius: 8,
                            displayColors: false
                        }
                    },
                    scales: {
                        x: {
                            display: false, // Hide X axis labels for cleaner look
                            grid: { display: false }
                        },
                        y: {
                            ticks: {
                                color: '#94a3b8',
                                font: { family: 'Inter', weight: 'bold', size: 10 },
                                stepSize: 2.0 // Ensures steps are 2, 4, 6...
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)',
                                borderDash: [4, 4]
                            },
                            beginAtZero: true
                        }
                    }
                }
            });

            // 4. Initial Dashboard Render
            ui.refreshDashboard();
        };
    </script>
</body>
</html>
