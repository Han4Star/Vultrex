<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vultrex Pro</title>
    
    <link rel="apple-touch-icon" href="https://img.icons8.com/ios-filled/512/3b82f6/v.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <style>
        @font-face {
            font-family: 'Minecraftia';
            src: url('https://db.onlinewebfonts.com/t/6ab539bc72105e7e2e92518450144f8b.woff2') format('woff2');
        }
        .sidebar-transition { transition: transform 0.3s ease; }
        .page-hidden { display: none; }
        .v-logo-box { background: #3b82f6; color: white; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 10px; font-weight: 900; font-size: 22px; }
        .mc-font { font-family: 'Minecraftia', monospace; line-height: 1.5; }
        .progress-bar { height: 4px; background: #3b82f6; border-radius: 10px; width: 0%; transition: width 0.3s; }
        @keyframes loading { 0% { width: 0%; } 50% { width: 70%; } 100% { width: 100%; } }
        .animate-load { animation: loading 2s infinite; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 min-h-screen font-sans">

    <div id="sidebar" class="fixed inset-y-0 left-0 w-72 bg-white dark:bg-slate-900 z-[60] shadow-2xl border-r border-slate-200 dark:border-slate-800 sidebar-transition -translate-x-full">
        <div class="p-8 flex flex-col h-full">
            <div class="flex items-center gap-3 mb-10">
                <div class="v-logo-box">V</div>
                <span class="text-2xl font-black italic tracking-tighter text-blue-600">Vultrex</span>
            </div>
            <nav class="space-y-2 flex-1">
                <button onclick="ui.switchPage('dashboard')" class="w-full text-left p-4 rounded-2xl hover:bg-blue-600/10 font-bold flex items-center gap-4">ðŸ“Š Dashboard</button>
                <button onclick="ui.switchPage('monitor')" class="w-full text-left p-4 rounded-2xl hover:bg-blue-600/10 font-bold flex items-center gap-4">ðŸŽ® Server Monitor</button>
                <button onclick="ui.openAdminPin()" class="w-full text-left p-4 rounded-2xl hover:bg-blue-600/10 font-bold flex items-center gap-4">ðŸ”’ Admin Panel</button>
            </nav>
            <button onclick="auth.logout()" class="w-full p-4 rounded-2xl text-rose-500 font-black uppercase text-xs bg-rose-500/5">Logout</button>
        </div>
    </div>
    <div id="sidebar-overlay" onclick="ui.toggleSidebar()" class="fixed inset-0 bg-black/50 z-[55] hidden backdrop-blur-sm"></div>

    <div class="p-6 max-w-5xl mx-auto">
        <header class="flex justify-between items-center mb-10">
            <button onclick="ui.toggleSidebar()" class="w-12 h-12 flex items-center justify-center bg-white dark:bg-slate-900 rounded-2xl shadow-sm border border-slate-200 dark:border-slate-800">â˜°</button>
            <div class="flex items-center gap-3">
                <div class="v-logo-box">V</div>
                <span class="text-xl font-black italic tracking-tighter text-blue-600">Vultrex</span>
            </div>
            <button onclick="ui.toggleTheme()" class="w-12 h-12 flex items-center justify-center rounded-2xl bg-slate-200 dark:bg-slate-800">ðŸŒ“</button>
        </header>

        <div id="page-dashboard">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="bg-white dark:bg-slate-900 p-8 rounded-[2.5rem] border border-slate-200 dark:border-slate-800">
                    <p class="text-[10px] text-slate-400 font-black uppercase">Balance</p>
                    <p id="balance" class="text-4xl font-black text-blue-600">0.00 â‚¬</p>
                </div>
                <div class="bg-white dark:bg-slate-900 p-8 rounded-[2.5rem] border border-slate-200 dark:border-slate-800">
                    <p class="text-[10px] text-rose-500 font-black uppercase">Monthly Costs</p>
                    <p id="monthly-stats" class="text-3xl font-black text-rose-500">0.00 â‚¬</p>
                </div>
            </div>
            <div class="bg-white dark:bg-slate-900 p-6 rounded-[2.5rem] border border-slate-200 dark:border-slate-800 mb-8">
                <canvas id="financeChart" height="120"></canvas>
            </div>
            <div class="flex gap-4 mb-8">
                <button onclick="ui.openModal('manual')" class="flex-1 bg-blue-600 text-white py-5 rounded-3xl font-black uppercase text-xs">New Entry</button>
                <button onclick="ui.openModal('import')" class="flex-1 bg-slate-900 dark:bg-white dark:text-slate-900 text-white py-5 rounded-3xl font-black uppercase text-xs italic">Smart Scan</button>
            </div>
            <div id="transaction-list" class="space-y-3"></div>
        </div>

        <div id="page-monitor" class="page-hidden">
            <div class="bg-white dark:bg-slate-900 p-8 rounded-[2.5rem] border border-slate-200 dark:border-slate-800 mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-black uppercase italic text-blue-600">Server Monitor</h3>
                    <div class="flex items-center gap-2">
                        <span class="text-[9px] font-black text-slate-400">AUTO</span>
                        <input type="checkbox" id="refresh-toggle" class="w-4 h-4 accent-blue-600">
                    </div>
                </div>
                <div class="flex gap-3">
                    <input type="text" id="mc-ip" placeholder="Server IP..." class="flex-1 bg-slate-100 dark:bg-slate-800 p-4 rounded-2xl outline-none font-bold">
                    <button onclick="monitor.check()" class="bg-blue-600 text-white px-8 rounded-2xl font-black uppercase">Scan</button>
                </div>
            </div>
            <div id="mc-result" class="hidden"></div>
        </div>

        <div id="page-admin" class="page-hidden space-y-4"></div>
    </div>

    <div id="modal" class="hidden fixed inset-0 bg-black/90 backdrop-blur-md flex items-center justify-center p-4 z-[100]">
        <div class="bg-white dark:bg-slate-900 w-full max-w-md p-8 rounded-[3rem] border border-slate-200 dark:border-slate-800">
            <div id="ui-manual" class="hidden text-center space-y-4">
                <h3 class="text-xl font-black text-blue-600 uppercase italic">Manual Entry</h3>
                <input type="text" id="m-desc" placeholder="Service" class="w-full bg-slate-100 dark:bg-slate-800 p-4 rounded-2xl outline-none font-bold">
                <input type="number" id="m-amt" placeholder="Amount" class="w-full bg-slate-100 dark:bg-slate-800 p-4 rounded-2xl outline-none font-bold">
                <select id="m-type" class="w-full bg-slate-100 dark:bg-slate-800 p-4 rounded-2xl font-bold">
                    <option value="once">One-Time</option>
                    <option value="monthly">Monthly Subscription</option>
                    <option value="income">Income</option>
                </select>
                <button onclick="logic.saveManual()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black uppercase">Confirm</button>
            </div>

            <div id="ui-import" class="hidden text-center space-y-4">
                <h3 class="text-xl font-black text-blue-600 uppercase italic">Smart Scan (PDF)</h3>
                <input type="file" id="pdf-file" accept=".pdf" class="w-full text-xs font-bold text-slate-400">
                <div id="scan-progress-container" class="hidden">
                    <div class="w-full bg-slate-200 dark:bg-slate-800 rounded-full h-1 overflow-hidden">
                        <div class="progress-bar animate-load" style="width: 100%"></div>
                    </div>
                </div>
                <button id="scan-btn" onclick="logic.processPDF()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black uppercase">Analyze File</button>
            </div>
            <button onclick="ui.closeModal()" class="w-full text-slate-400 py-4 font-bold text-[10px] uppercase mt-2">Close</button>
        </div>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        let state = JSON.parse(localStorage.getItem('v_data')) || { history: [] };
        let chart = null;

        const ui = {
            toggleSidebar() {
                document.getElementById('sidebar').classList.toggle('-translate-x-full');
                document.getElementById('sidebar-overlay').classList.toggle('hidden');
            },
            toggleTheme() {
                document.documentElement.classList.toggle('dark');
            },
            switchPage(id) {
                ['dashboard', 'monitor', 'admin'].forEach(p => document.getElementById('page-'+p).classList.add('page-hidden'));
                document.getElementById('page-'+id).classList.remove('page-hidden');
                this.toggleSidebar();
            },
            openModal(type) {
                document.getElementById('modal').classList.remove('hidden');
                document.getElementById('ui-manual').classList.toggle('hidden', type !== 'manual');
                document.getElementById('ui-import').classList.toggle('hidden', type !== 'import');
            },
            closeModal() { document.getElementById('modal').classList.add('hidden'); },
            updateDashboard() {
                let bal = 0, mon = 0;
                const list = document.getElementById('transaction-list');
                list.innerHTML = '';
                state.history.forEach((t, i) => {
                    bal += t.amount;
                    if(t.type === 'monthly' && t.amount < 0) mon += t.amount;
                    list.innerHTML = `<div class="bg-white dark:bg-slate-900 p-5 rounded-3xl border border-slate-200 dark:border-slate-800 flex justify-between items-center">
                        <div><p class="font-bold text-sm">${t.desc}</p><p class="text-[8px] font-black text-slate-400 uppercase">${t.date}</p></div>
                        <p class="font-black ${t.amount < 0 ? 'text-rose-500' : 'text-emerald-500'}">${t.amount.toFixed(2)} â‚¬</p>
                    </div>` + list.innerHTML;
                });
                document.getElementById('balance').innerText = bal.toFixed(2) + " â‚¬";
                document.getElementById('monthly-stats').innerText = Math.abs(mon).toFixed(2) + " â‚¬";
                this.renderChart();
            },
            renderChart() {
                if(!chart) return;
                const points = state.history.map((t, i) => state.history.slice(0, i+1).reduce((a, b) => a + b.amount, 0));
                chart.data.labels = state.history.map(t => t.date);
                chart.data.datasets[0].data = points;
                chart.update();
            }
        };

        const logic = {
            saveManual() {
                const desc = document.getElementById('m-desc').value || 'Entry';
                let amt = parseFloat(document.getElementById('m-amt').value) || 0;
                const type = document.getElementById('m-type').value;
                if(type !== 'income') amt = -amt;
                state.history.push({ id: Date.now(), desc, amount: amt, type, date: new Date().toLocaleDateString('de-DE') });
                this.save();
                ui.closeModal();
                ui.updateDashboard();
            },
            async processPDF() {
                const file = document.getElementById('pdf-file').files[0];
                if(!file) return alert("WÃ¤hle eine PDF!");
                document.getElementById('scan-progress-container').classList.remove('hidden');
                
                const reader = new FileReader();
                reader.onload = async (e) => {
                    const pdf = await pdfjsLib.getDocument({data: new Uint8Array(e.target.result)}).promise;
                    let text = "";
                    for(let i=1; i<=pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const content = await page.getTextContent();
                        text += content.items.map(item => item.str).join(" ");
                    }
                    const match = text.match(/(\d+,\d{2})/);
                    const val = match ? parseFloat(match[0].replace(',', '.')) : 10.00;
                    state.history.push({ id: Date.now(), desc: 'PDF Scan', amount: -val, type: 'once', date: new Date().toLocaleDateString('de-DE') });
                    this.save();
                    document.getElementById('scan-progress-container').classList.add('hidden');
                    ui.closeModal();
                    ui.updateDashboard();
                };
                reader.readAsArrayBuffer(file);
            },
            save() { localStorage.setItem('v_data', JSON.stringify(state)); }
        };

        const monitor = {
            async check() {
                const ip = document.getElementById('mc-ip').value;
                if(!ip) return;
                const resDiv = document.getElementById('mc-result');
                resDiv.innerHTML = "<p class='text-center p-10 animate-pulse font-black'>SCANNING...</p>";
                resDiv.classList.remove('hidden');
                try {
                    const res = await fetch(`https://api.mcstatus.io/v2/status/java/${ip}`);
                    const data = await res.json();
                    if(data.online) {
                        const players = (data.players.list || []).filter(p => p.name);
                        resDiv.innerHTML = `
                            <div class="bg-white dark:bg-slate-900 p-8 rounded-[3rem] border border-slate-200 dark:border-slate-800 shadow-xl">
                                <div class="flex items-center gap-4 mb-6">
                                    <img src="${data.icon || 'https://i.imgur.com/vH977y0.png'}" class="w-16 h-16 rounded-xl">
                                    <h4 class="text-xl font-black text-blue-600">${ip}</h4>
                                </div>
                                <div class="bg-black p-6 rounded-2xl mb-6 mc-font text-[#ccc] text-sm overflow-hidden border border-slate-800">
                                    ${data.motd.html}
                                </div>
                                <div class="grid grid-cols-2 gap-4 mb-6">
                                    <div class="bg-slate-100 dark:bg-slate-800 p-4 rounded-2xl text-center"><p class="text-[8px] font-black uppercase">Players</p><p class="font-black">${data.players.online}/${data.players.max}</p></div>
                                    <div class="bg-slate-100 dark:bg-slate-800 p-4 rounded-2xl text-center"><p class="text-[8px] font-black uppercase">Version</p><p class="text-[10px] font-black truncate">${data.version.name_clean}</p></div>
                                </div>
                                <div class="grid grid-cols-4 sm:grid-cols-6 gap-2">
                                    ${players.map(p => `
                                        <div class="bg-slate-50 dark:bg-slate-800 p-2 rounded-lg text-center">
                                            <img src="https://mc-heads.net/avatar/${p.name}/32" class="w-8 h-8 mx-auto mb-1">
                                            <p class="text-[7px] font-black truncate">${p.name}</p>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>`;
                    } else { resDiv.innerHTML = "<p class='text-center p-10 text-rose-500 font-black'>OFFLINE</p>"; }
                } catch(e) { resDiv.innerHTML = "<p class='text-center p-10 text-rose-500 font-black'>ERROR</p>"; }
            }
        };

        window.onload = () => {
            const ctx = document.getElementById('financeChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: { labels: [], datasets: [{ data: [], borderColor: '#3b82f6', tension: 0.4, fill: true, backgroundColor: 'rgba(59, 130, 246, 0.05)', borderWidth: 3, pointRadius: 0 }] },
                options: { responsive: true, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
            });
            ui.updateDashboard();
        };
    </script>
</body>
</html>
